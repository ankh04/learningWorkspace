## 数据库是存放在主存中还是磁盘上？
对于大多数计算机来说内存并不足以容纳数据库，一般来说，数据库是存储在磁盘上的，只有在读取数据时，才会把相应的数据复制到主存中。

当然，也有存放在主存上的数据库（比如Redis），这种数据库称为*主存数据库*，这种数据库没有缓冲区管理，从而可以更快的响应请求。

## 数据库存储结构的基本单元是什么？
一个数据库被映射为多个不同的*文件*，每个文件又被划分为若干个固定大小的*块*
块是存储结构的基本单元

我们通常假定一个记录的长度不会大于块的大小。

## 什么是定长记录？什么是变长记录？它们是怎么添加、删除记录的？
==定长记录==
定长记录会把所有的变长属性（比如varchar）的大小设置为最大值。每个块只存放一个记录。
删除记录时，会把当前记录的地址放到上一个删除地址的目的地址（从而形成一个自由链表）。（这样做可以让删除动作加快，不需要让后面的元素前移，同时也避免了存储空间的碎片化）
在每次添加记录时，沿着自由链表找空着的块，然后在更新链表地址。

==变长记录==
变长记录指的是一个记录中不同属性的访问地址可能是不确定的。
通常的做法是在每个块中增加一个*块头*，在块头中记录每个属性的起始地址和长度

## 在数据库文件中，记录被如何组织？
有许多不同的组织方式，有以下几种：
- 堆文件组织
	堆文件中记录可以存放在任何位置，并且一旦被指定位置后，通常不会改变
	既然可以放在任何位置，那么我们的目标就是让空间利用率尽量高。（这体现在在删除文件后，能够快速找到空着的位置）
	大多数数据库会采用*自由空间图*的数据结构来进行存储。
- 顺序文件组织
	顺序文件组织是按某个*搜索码*的顺序排序记录。这样做可以让某个顺序查询速度变快
	通产采取自由链表的方式进行删除和添加记录
- 多表聚簇组织
	在处理join查询时，这种组织方式会很方便，它会按照某个属性分组，将多个表的同一组的数据放得很近（从而让join查询变快）
	Oracle数据库可以用 create cluster 命令创建聚簇表
- B+树文件组织
- 散列文件组织
- 划分组织
	将一个大表拆分成若干个小表查询，从而优化查询速度。（甚至可以把不同的小表放在不同的存储介质中，优先级高的小表放在访问速度快的存储器中（比如SSD)，优先级低的放在便宜的存储器中）

## 数据字典是什么？有什么作用？
数据库除了要维护关系中的数据，还要维护关于关系本身的数据（比如表的模式、所有权等），这样的数据就是数据字典。常见的字段有：
- 关系的名称
- 关系中属性的名称
- 属性的域和长度
- 视图的定义
- 完整性约束
- 用户的名称
- 用户的授权信息

因为数据字典是被访问最频繁的数据，大多数数据库将数据字典放在内存中，从而可以很高效地访问。

## 什么是数据库缓冲区？有什么作用？
数据库占用的空间往往是很大的，以至于不可能把整个数据库放进主存。另一方面，操作系统也不可能把所有主存都分配给数据库。

一个常用的方法是在主存中分配一个相对小的数据库缓冲区，在缓冲区中只存放热点数据，而不是把所有数据都放入主存。

另一方面，用户如果希望从磁盘中的数据库读取数据，则必须先把数据复制到主存才可以访问。这时候数据库缓冲区就负责这个复制操作。如果缓冲区没有满，则直接复制进来，如果满了，则需要进行*换出*。如果被换出的块被修改过，则需要重新写回磁盘。

通过上面的描述可以发现，数据库缓冲区的作用和虚拟内存的作用很相似。

==那为什么不直接用虚拟内存呢？==
- 数据库系统和操作系统还是有区别的，从而导致了换出规则可能不一样（大多数操作系统采用最近最少原则LRU，但由于数据库系统可以看到用户的请求指令，而不像操作系统那样对用户的操作没有任何先见性的信息，数据库可以采用更加精细的换出规则）ß
- 另一方面，数据库还需要处理事务相关的工作，直接用虚拟内存提供的管理服务很难做到这一点。

## 什么是面相列的存储？什么是面相行的存储？
面相列的存储就是把每个属性存储在各种的单独文件中，这样做的好处是对于数据分析查询会有好处（原因是，数据分析查询往往只获取少数几个属性的所有行）

但面向列的存储对于记录的重排、删除、更新的代价会很大。

## 什么是B+树？和红黑树有什么区别？
B Tree指的是 Balance Tree 即平衡树。

**平衡树的特点：**
- 同一层中每个节点的子树高度都相同（或是差1）
- 所有叶子结点都位于同一层
- 平衡树的目的是为了让树的高度尽量小（因为不平衡的树高度会更高）

B+树则是把平衡树拓展为n叉树，同一层的节点通过指针进行关联。B+树还规定了每个节点的子节点的最少个数和最多个数。



**与红黑树的区别：**
红黑树可以保证树的高度最多为2log_2(n+1), 而B+树可以保证树的高度为log_d(n)，可以看到红黑树的每个节点的*出度*为2，而B+树中每个节点的出度为d。
在数据库中d往往被设置为100~200甚至更多，因此B+树的高度会比红黑树低很多（B+树往往是矮而胖的），从而B+树的索引会更快。

另外一点，现在的存储结构往往是顺序读取速度更快。而B+树可以让相邻节点放在磁盘中接近的位置（比如同一个块中），从而加快了检索速度。