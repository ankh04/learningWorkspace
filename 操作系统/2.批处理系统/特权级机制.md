因为批处理操作系统也是程序, 我们需要确保在批处理操作系统上的程序不会影响到操作系统本身.

特权机制需要硬件和软件的配置


为确保操作系统的安全, 对应用程序而言, 有两方面的限制:
- 应用程序不能访问任意的地址空间
- 应用程序不能执行可能破坏计算机系统的指令


当应用程序需要调用操作系统提供的功能时, 会使用`ecall`, `eret`指令.


RISC-V有四种特权级别: U S H M

H特权级RISC规范还没设定好
M级别--RustSBI 启动引导程序
S级别-- 操作系统
U级别 -- 应用程序


使用ecall调用的功能和调用函数是不一样的==控制流==, 是*异常控制流*

下面是应用程序调用ecall的时候发生的示意图
![](https://picture-bed-1301848969.cos.ap-shanghai.myqcloud.com/20220507115058.png)


### 特权级相关的寄存器和指令
通用寄存器 x0 ~ x31 在任何特权级都可以执行
与特权级无关的通用指令在任何特权级都可以执行

不同的特权级有各自的*控制状态寄存器(CSR, Control and Status Register)*
读写对应CSR的指令也是与特权级相关的(CSR读写的指令都是==原子的==)
