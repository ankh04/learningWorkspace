在Java中, 可以用`synchronized`关键词给代码加锁, 这种加锁机制是依赖于底层提供的加锁功能.

对于 riscv 来说, 有两个和加锁相关的指令: `lr.d`   `sc.d`

## 为什么要加锁
对于多线程程序, 可能会有多个程序同时访问/修改同一个变量的情况, 发生[[线程安全性#竞态条件|竞态条件]], 这种时候需要确定在某一时刻只能有一个线程可以访问/修改.

## RISC-V中的加锁机制
在指令集中, 上述的锁🔒 指的是一个寄存器的值. 如果这个寄存器的值为1, 那么就是锁上了; 如果寄存器的值为0, 就是还没上锁, 可以访问.

>language is weak, show me the code

```asm
again:  lr.d x10, (x20) // 读出 x20 地址对应内存里的值到 x10. 同步代码块开始
		... // 同步代码: 可以对 x20 地址对应内存的值进行操作, 操作的结果暂存到 x23 上
		sc.d x11, x23, (x20) //如果 x20 地址对应内存里的值发生改变, x11 为零, 否则为1. 如果 x11 为 1, 则把 x23 里的值放入 x20 地址对应的内存里. 同步代码块结束
		bne x11, x0, again // 如果 x11 为零, 跳转到 again 再次执行
...
```
