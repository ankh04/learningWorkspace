# 堆
## 概述
#### 存什么?
"**几乎**"所有对象都存储在堆区, 数组都存在堆区
数组和对象都以引用的方式存储在**栈**中

#### 什么时候创建?
一个JVM对应一个堆, 堆区在JVM启动的时候创建, 堆区的大小可以可以通过 JVM 参数设置.

#### 堆区的唯一性
由于一个JVM对应一个堆, 一个JVM里的所有线程都共享同一个堆区(但需要注意, 堆区里有一个缓冲区 TLAB, 这个位置是每个线程一份的).

#### 堆区的连续性
堆在**物理**上可以不是连续的, 但是在**逻辑**上是连续的(即在JVM虚拟机内部看来, 堆的地址是连续的, 但在操作系统看来堆区的地址其实是不连续的, 造成这种差别的原因是因为虚拟做了相应的接口)

#### 回收
在方法结束后, 对象不会马上销毁, 只会在垃圾回收时进行清除
堆是垃圾回收的重点

#### 结构
分为 `新生区` `养老区` `元空间(Java7之前叫永久区)`
新生区又分为: `Eden区` `Survivor区`
Survivor区又分为两个区, 只有一个区会存储数据

#### 指令
- 查看GC回收详情
`-XX:+PrintGCDetail`
- jvisualvm

## 设置堆内存大小
- `-Xms:1G` 表示起始堆区大小为1G
- `-Xmx:1G` 表示最大堆区大小为1G(通常把最大堆区和起始堆区设成一样的,可以减少GC的性能消耗)

- 默认行为:
	- 初试大小为: 电脑物理内存的1/64
	- 最大大小为: 电脑屋里内存的1/4

- 指令
	- jps命令: 查看当前正在运行的Java进程
	- jstat命令: `jstat -gc 进程号`, 参看JVM在GC时的统计信息
